[ 2018-08-23 05:04:12 ] <pre>\r\n<code class=\"language-php\">&lt;?php\r\nfunction update_post($post_sn) {\r\n    global $mysqli, $is_top;\r\n    foreach ($_POST as $var_title =&gt; $var_value) {\r\n        if ($var_title != \'post_content\') {\r\n            $$var_title = $mysqli-&gt;real_escape_string($_POST[$var_title]);\r\n        }\r\n    }\r\n    $sql = \"SELECT * FROM `post` WHERE `post_sn`=\'{$post_sn}\'\";\r\n    $result = $mysqli-&gt;query($sql) or die(mysqli_error($mysqli));\r\n    $post = $result-&gt;fetch_assoc();\r\n    if (!$is_top and $_SESSION[\'user_sn\'] != $post[\'post_owner\']) {\r\n        die(\'你沒有權限修改文章喔 廠廠⧸⎩⎠⎞͏(・∀・)⎛͏⎝⎭⧹\');\r\n    }\r\n    $sql = \"UPDATE `post` SET\r\n    `post_title`=\'{$post_title}\',\r\n    `post_content`=\'{$post_content}\',\r\n    `post_tag`=\'{$post_tag}\'\r\n    WHERE `post_sn`=\'{$post_sn}\'\";\r\n    if ($mysqli-&gt;query($sql)) {\r\n        save_post_pic($post_sn);\r\n    } else {\r\n        die(mysqli_error($mysqli));\r\n    }\r\n}</code></pre>\r\n\r\n<p>&nbsp;</p>\r\n
[ 2018-08-23 05:11:14 ] <pre>\r\n<code class=\"language-php\">\r\n&lt;?php\r\nfunction post_display($post_sn) {\r\n    global $mysqli, $smarty;\r\n    $sql = \"SELECT * FROM `post` WHERE `post_sn`=\'{$post_sn}\'\";\r\n    $result = $mysqli-&gt;query($sql) or die($mysqli-&gt;connect_error);\r\n    $post = $result-&gt;fetch_assoc();\r\n    $post[\'pic\'] = get_pic_path(\"./uploads/post/{$post_sn}/normal_post_pic.png\", \"./img/normal_get_pic.jpg\");\r\n    $post[\'tag\'] = explode(\";\", $post[\'post_tag\']);\r\n    $sql = \"SELECT * FROM `users` WHERE `user_sn`=\'{$post[\'post_owner\']}\'\";\r\n    $result = $mysqli-&gt;query($sql) or die($mysqli-&gt;connect_error);\r\n    $user = $result-&gt;fetch_assoc();\r\n    $post[\'user_sn\'] = $user[\'user_sn\'];\r\n    if (!empty($user) and $user != \'\') {\r\n        $post[\'post_owner\'] = $user[\'user_name\'];\r\n    } else {\r\n        $post[\'post_owner\'] = \"不明\";\r\n    }\r\n    if (!file_exists(\"uploads/post/{$post_sn}/{$post_sn}.html\")) {\r\n        copy(\"templates/default.html\", \"uploads/post/{$post_sn}/{$post_sn}.html\");\r\n    }\r\n    $sql = \"SELECT * FROM `cmt` WHERE `post_sn`=\'{$post_sn}\'\";\r\n    $result = $mysqli-&gt;query($sql) or die($mysqli-&gt;connect_error);\r\n    $i = 0;\r\n    while ($cmt=$result-&gt;fetch_assoc()) {\r\n        $post[\"cmt\"][$i] = $cmt;\r\n        $ssql = \"SELECT * FROM `users` WHERE `user_sn`=\'{$cmt[\'user_sn\']}\'\";\r\n        $rresult = $mysqli-&gt;query($ssql) or die($mysqli-&gt;connect_error);\r\n        $owner = $rresult-&gt;fetch_assoc();\r\n        $post[\"cmt\"][$i][\"user_sn\"] = $owner[\'user_sn\'];\r\n        $post[\"cmt\"][$i][\"user_name\"] = $owner[\'user_name\'];\r\n        $post[\"cmt\"][$i][\"user_pic\"] = get_pic_path(\"./uploads/users/{$cmt[\'user_sn\']}/thumb_user_pic.png\", \"./img/thumb_get_pic.jpg\");\r\n        $ssql = \"SELECT * FROM `cmt` WHERE `reply_sn`=\'{$cmt[\'cmt_sn\']}\'\";\r\n        $rresult = $mysqli-&gt;query($ssql) or die($mysqli-&gt;connect_error);\r\n        $j = 0;\r\n        while ($reply=$rresult-&gt;fetch_assoc()) {\r\n            $post[\"cmt\"][$i][\'reply\'][$j] = $reply;\r\n            $sssql = \"SELECT * FROM `users` WHERE `user_sn`=\'{$reply[\'user_sn\']}\'\";\r\n            $rrresult = $mysqli-&gt;query($sssql) or die($mysqli-&gt;connect_error);\r\n            $user = $rrresult-&gt;fetch_assoc();\r\n            if ($user) {\r\n                $post[\'cmt\'][$i][\'reply\'][$j][\'user_sn\'] = $user[\'user_sn\'];\r\n                $post[\"cmt\"][$i][\'reply\'][$j][\"user_name\"] = $user[\'user_name\'];\r\n                $post[\"cmt\"][$i][\'reply\'][$j][\"user_pic\"] = get_pic_path(\"./uploads/users/{$user[\'user_sn\']}/thumb_user_pic.png\", \"./img/thumb_get_pic.jpg\");\r\n            }\r\n            $j++;\r\n        }\r\n        $i++;\r\n    }\r\n    $smarty-&gt;assign(\"post\", $post);\r\n    $sql = \"UPDATE `post` SET\r\n    `post_counter`=`post_counter`+1\r\n    WHERE `post_sn`=\'{$post_sn}\'\";\r\n    $mysqli-&gt;query($sql) or die($mysqli-&gt;connect_error);\r\n}</code></pre>\r\n\r\n<p>&nbsp;</p>\r\n
